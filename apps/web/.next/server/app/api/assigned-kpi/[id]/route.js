"use strict";(()=>{var e={};e.id=8375,e.ids=[8375],e.modules={3295:e=>{e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},21820:e=>{e.exports=require("os")},28354:e=>{e.exports=require("util")},29021:e=>{e.exports=require("fs")},29294:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{e.exports=require("path")},44870:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{e.exports=require("crypto")},63033:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},73226:(e,s,r)=>{r.r(s),r.d(s,{patchFetch:()=>k,routeModule:()=>c,serverHooks:()=>g,workAsyncStorage:()=>_,workUnitAsyncStorage:()=>m});var i={};r.r(i),r.d(i,{DELETE:()=>u,GET:()=>o,PUT:()=>l});var t=r(31453),a=r(91306),n=r(71817),d=r(56492),p=r(3998);async function o(e,{params:s}){try{let{id:e}=s;if(isNaN(e))return d.NextResponse.json({success:!1,error:"Invalid assigned KPI ID"},{status:400});let r=await p.prisma.assigned_kpi.findUnique({where:{assigned_kpi_id:e},include:{pillar:{include:{department:!0}}}});if(!r)return d.NextResponse.json({success:!1,error:"Assigned KPI not found"},{status:404});let i={assigned_kpi_id:r.assigned_kpi_id,pillar_id:r.pillar_id,department_id:r.pillar.department_id,kpi_name:r.kpi_name,kpi_status:r.kpi_status,added_date:r.added_date,resolved_date:r.resolved_date,comments:r.comments,kpi_value:r.kpi_value,kpi_description:r.kpi_description,form_input:r.form_input,pillar:r.pillar,department:r.pillar.department,id:`assigned-${r.assigned_kpi_id}`,elements:r.form_data};return d.NextResponse.json({success:!0,assignedKpi:i})}catch(e){return console.error("Error fetching assigned KPI:",e),d.NextResponse.json({success:!1,error:"Failed to fetch assigned KPI"},{status:500})}}async function l(e,{params:s}){try{let{id:r}=s,i=Number(r);if(isNaN(i))return d.NextResponse.json({success:!1,error:"Invalid assigned KPI ID"},{status:400});let t=await e.json(),{kpi_status:a,comments:n,elements:o,resolved_date:l,kpi_value:u,kpi_description:c,form_input:_}=t,m=await p.prisma.assigned_kpi.findUnique({where:{assigned_kpi_id:i},include:{pillar:{include:{department:!0}}}});if(!m)return d.NextResponse.json({success:!1,error:"Assigned KPI not found"},{status:404});if(t.department_id&&m.pillar.department_id!==Number(t.department_id))return d.NextResponse.json({success:!1,error:"Cannot change the department of an assigned KPI"},{status:400});if(t.pillar_id&&t.pillar_id!==m.pillar_id&&!await p.prisma.pillars.findFirst({where:{pillar_id:Number(t.pillar_id),department_id:m.pillar.department_id}}))return d.NextResponse.json({success:!1,error:"New pillar must belong to the same department"},{status:400});let g={};t.pillar_id&&(g.pillar_id=Number(t.pillar_id)),void 0!==a&&(g.kpi_status=a),void 0!==n&&(g.comments=n),o&&(g.form_data=o),l&&(g.resolved_date=new Date(l)),void 0!==u&&(g.kpi_value=u),void 0!==c&&(g.kpi_description=c),void 0!==_&&(g.form_input=_);let k=await p.prisma.assigned_kpi.update({where:{assigned_kpi_id:i},data:g,include:{pillar:{include:{department:!0}}}});return d.NextResponse.json({success:!0,message:"Assigned KPI updated successfully",assignedKpi:{assigned_kpi_id:k.assigned_kpi_id,pillar_id:k.pillar_id,department_id:k.pillar.department_id,kpi_name:k.kpi_name,kpi_status:k.kpi_status,added_date:k.added_date,resolved_date:k.resolved_date,comments:k.comments,kpi_value:k.kpi_value,kpi_description:k.kpi_description,form_input:k.form_input,department:k.pillar.department,pillar:k.pillar,id:`assigned-${k.assigned_kpi_id}`,elements:k.form_data}})}catch(e){return console.error("Error updating assigned KPI:",e),d.NextResponse.json({success:!1,error:"Failed to update assigned KPI"},{status:500})}}async function u(e,{params:s}){try{let{id:e}=s,r=Number(e);if(isNaN(r))return d.NextResponse.json({success:!1,error:"Invalid assigned KPI ID"},{status:400});let i=await p.prisma.assigned_kpi.findUnique({where:{assigned_kpi_id:r},include:{pillar:!0}});if(!i)return d.NextResponse.json({success:!1,error:"Assigned KPI not found"},{status:404});let t={pillar_id:i.pillar_id,department_id:i.pillar.department_id,kpi_name:i.kpi_name};return await p.prisma.assigned_kpi.delete({where:{assigned_kpi_id:r}}),d.NextResponse.json({success:!0,message:"Assigned KPI deleted successfully",deleted:{assigned_kpi_id:r,...t}})}catch(e){return console.error("Error deleting assigned KPI:",e),d.NextResponse.json({success:!1,error:"Failed to delete assigned KPI"},{status:500})}}let c=new t.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/assigned-kpi/[id]/route",pathname:"/api/assigned-kpi/[id]",filename:"route",bundlePath:"app/api/assigned-kpi/[id]/route"},resolvedPagePath:"/Users/vverma/ERP/ERP-SYS/apps/web/app/api/assigned-kpi/[id]/route.ts",nextConfigOutput:"",userland:i}),{workAsyncStorage:_,workUnitAsyncStorage:m,serverHooks:g}=c;function k(){return(0,n.patchFetch)({workAsyncStorage:_,workUnitAsyncStorage:m})}},79646:e=>{e.exports=require("child_process")},79748:e=>{e.exports=require("fs/promises")},83997:e=>{e.exports=require("tty")},84297:e=>{e.exports=require("async_hooks")},94735:e=>{e.exports=require("events")}};var s=require("../../../../webpack-runtime.js");s.C(e);var r=e=>s(s.s=e),i=s.X(0,[3747,3332,2302],()=>r(73226));module.exports=i})();