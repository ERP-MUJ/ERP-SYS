"use strict";(()=>{var e={};e.id=3188,e.ids=[3188],e.modules={3295:e=>{e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},21820:e=>{e.exports=require("os")},28354:e=>{e.exports=require("util")},29021:e=>{e.exports=require("fs")},29294:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{e.exports=require("path")},44870:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{e.exports=require("crypto")},63033:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},79646:e=>{e.exports=require("child_process")},79748:e=>{e.exports=require("fs/promises")},83997:e=>{e.exports=require("tty")},84297:e=>{e.exports=require("async_hooks")},91186:(e,r,t)=>{t.r(r),t.d(r,{patchFetch:()=>y,routeModule:()=>m,serverHooks:()=>f,workAsyncStorage:()=>x,workUnitAsyncStorage:()=>h});var s={};t.r(s),t.d(s,{DELETE:()=>l,GET:()=>i,POST:()=>d,PUT:()=>c});var n=t(31453),a=t(91306),o=t(71817),u=t(56492),p=t(3998);async function i(e){try{let e=await p.prisma.departments.findMany({include:{pillars:{select:{pillar_id:!0,pillar_name:!0,_count:{select:{assigned_kpi:!0}}}},_count:{select:{members:!0}}}});return u.NextResponse.json({success:!0,departments:e})}catch(e){return console.error("Error fetching departments:",e),u.NextResponse.json({success:!1,error:"Failed to fetch departments"},{status:500})}}async function d(e){try{let{dept_name:r,hod_id:t,hod_name:s}=await e.json();if(!r)return u.NextResponse.json({success:!1,error:"Department name is required"},{status:400});if(await p.prisma.departments.findUnique({where:{dept_name:r}}))return u.NextResponse.json({success:!1,error:"A department with this name already exists"},{status:400});let n=await p.prisma.departments.create({data:{dept_name:r,hod_id:t||null,hod_name:s||null}});return u.NextResponse.json({success:!0,message:"Department created successfully",department:n})}catch(e){return console.error("Error creating department:",e),u.NextResponse.json({success:!1,error:"Failed to create department"},{status:500})}}async function c(e){try{let r;try{r=await e.json()}catch(e){return console.error("Error parsing JSON body:",e),u.NextResponse.json({success:!1,error:"Invalid JSON in request body"},{status:400})}if(!r||0===Object.keys(r).length)return u.NextResponse.json({success:!1,error:"Request body is empty"},{status:400});let{dept_id:t,dept_name:s,hod_id:n,hod_name:a}=r;if(!t)return u.NextResponse.json({success:!1,error:"Department ID is required"},{status:400});if(!await p.prisma.departments.findUnique({where:{dept_id:Number(t)}}))return u.NextResponse.json({success:!1,error:"Department not found"},{status:404});let o={};s&&(o.dept_name=s),void 0!==n&&(o.hod_id=n||null),void 0!==a&&(o.hod_name=a||null);let i=await p.prisma.departments.update({where:{dept_id:Number(t)},data:o});return u.NextResponse.json({success:!0,message:"Department updated successfully",department:i})}catch(e){if(console.error("Error updating department:",e),"P2002"===e.code)return u.NextResponse.json({success:!1,error:"A department with this name already exists"},{status:400});return u.NextResponse.json({success:!1,error:"Failed to update department"},{status:500})}}async function l(e){try{let{searchParams:r}=new URL(e.url),t=r.get("id");if(!t)return u.NextResponse.json({success:!1,error:"Department ID is required"},{status:400});if(!await p.prisma.departments.findUnique({where:{dept_id:Number(t)}}))return u.NextResponse.json({success:!1,error:"Department not found"},{status:404});return await p.prisma.departments.delete({where:{dept_id:Number(t)}}),u.NextResponse.json({success:!0,message:"Department deleted successfully"})}catch(e){return console.error("Error deleting department:",e),u.NextResponse.json({success:!1,error:"Failed to delete department"},{status:500})}}let m=new n.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/department/route",pathname:"/api/department",filename:"route",bundlePath:"app/api/department/route"},resolvedPagePath:"/Users/vverma/ERP/ERP-SYS/apps/web/app/api/department/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:x,workUnitAsyncStorage:h,serverHooks:f}=m;function y(){return(0,o.patchFetch)({workAsyncStorage:x,workUnitAsyncStorage:h})}},94735:e=>{e.exports=require("events")}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[3747,3332,2302],()=>t(91186));module.exports=s})();