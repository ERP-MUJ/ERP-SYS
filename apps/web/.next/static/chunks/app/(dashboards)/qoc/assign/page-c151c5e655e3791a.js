(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1839],{229:(e,t,s)=>{"use strict";s.d(t,{E:()=>d});var r=s(7589);s(273);var a=s(2544),i=s(7135),n=s(3350);let l=(0,i.F)("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground",pending:"border-transparent bg-yellow-200 text-yellow-800 [a&]:hover:bg-yellow-300 focus-visible:ring-yellow-200/50",rejected:"border-transparent bg-red-200 text-red-800 [a&]:hover:bg-red-300 focus-visible:ring-red-200/50",approved:"border-transparent bg-green-200 text-green-800 [a&]:hover:bg-green-300 focus-visible:ring-green-200/50"}},defaultVariants:{variant:"default"}});function d(e){let{className:t,variant:s,asChild:i=!1,...d}=e,o=i?a.DX:"span";return(0,r.jsx)(o,{"data-slot":"badge",className:(0,n.cn)(l({variant:s}),t),...d})}},2792:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>h});var r=s(7589),a=s(4764),i=s(9390),n=s(3269),l=s(6896),d=s(295),o=s(3497);let c=async()=>(await d.A.get("/api/department")).data.departments.map(e=>({id:e.dept_id,name:e.dept_name,pillars:(e.pillars||[]).map(e=>({id:e.pillar_id,name:e.pillar_name}))})),u=(e,t)=>(0,n.useQuery)({queryKey:["assignedKpis",e,t],queryFn:async()=>{if(!e||!t)return null;let s=await fetch("/api/assigned-kpi?department_id=".concat(e,"&pillar_id=").concat(t));if(!s.ok)throw Error("Failed to fetch assigned KPIs");return s.json()},enabled:!!e&&!!t});var g=s(7018),p=s(8980),x=s(273),m=s(6348),v=s(229);function h(){var e,t,s,h;let{data:f,isLoading:b}=(0,n.useQuery)({queryKey:["depts"],queryFn:c,staleTime:18e5,refetchOnWindowFocus:!1}),{data:y}=(0,g.Pm)(),j=(0,l.useMutation)({mutationFn:async e=>(console.log(e),(await d.A.post("/api/assigned-kpi",e)).data),onSuccess:()=>{o.toast.success("KPIs successfully assigned!")},onError:e=>{var t,s;let r=(null===(s=e.response)||void 0===s?void 0:null===(t=s.data)||void 0===t?void 0:t.error)||e.message||"Unknown error occurred";o.toast.error("Error assigning KPI",{description:r})}}),[w,N]=(0,x.useState)(null),[k,P]=(0,x.useState)(null),[K,S]=(0,x.useState)([]),[_,I]=(0,x.useState)(null),[C,A]=(0,x.useState)("assign"),[z,E]=(0,x.useState)(null),[F,q]=(0,x.useState)(null),{data:L,isLoading:Q,isError:D,error:V}=u(z,F);console.log("Assigned KPIs:",L);let O=(null==f?void 0:null===(e=f.find(e=>e.id.toString()===w))||void 0===e?void 0:e.pillars)||[],R=(null==f?void 0:null===(t=f.find(e=>e.id.toString()===z))||void 0===t?void 0:t.pillars)||[],T=e=>{S(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])};return(0,r.jsxs)("main",{className:"container mx-auto px-4 py-8",children:[(0,r.jsx)("div",{className:"mb-8 flex items-center justify-between",children:(0,r.jsx)("h1",{className:"text-3xl font-bold",children:"KPI Management"})}),(0,r.jsx)("div",{className:"mb-6 border-b border-gray-300",children:(0,r.jsxs)("ul",{className:"-mb-px flex text-center text-sm font-medium",children:[(0,r.jsx)("li",{className:"cursor-pointer px-4 py-2 ".concat("assign"===C?"border-b-1 border-secondary text-primary":""),onClick:()=>A("assign"),children:"Assign KPI"}),(0,r.jsx)("li",{className:"cursor-pointer px-4 py-2 ".concat("assigned"===C?"border-b-1 border-secondary text-primary":""),onClick:()=>A("assigned"),children:"Assigned KPI"})]})}),"assign"===C&&(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"mb-8 flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-3xl font-bold",children:"Assign KPIs"}),(0,r.jsx)("p",{className:"mt-2 text-gray-600",children:"Assign KPIs by selecting the department."})]}),(0,r.jsxs)(a.l6,{onValueChange:e=>{N(e);let t=null==f?void 0:f.find(t=>t.id.toString()===e);P((null==t?void 0:t.name)||null),S([])},children:[(0,r.jsx)(a.bq,{children:(0,r.jsx)(a.yv,{placeholder:"Select a department"})}),(0,r.jsx)(a.gC,{children:null==f?void 0:f.map(e=>(0,r.jsx)(a.eb,{value:e.id.toString(),children:e.name},e.id))})]}),w&&(0,r.jsxs)(a.l6,{onValueChange:e=>{I(e)},children:[(0,r.jsx)(a.bq,{children:(0,r.jsx)(a.yv,{placeholder:"Select a pillar"})}),(0,r.jsx)(a.gC,{children:O.length>0?O.map(e=>(0,r.jsx)(a.eb,{value:e.id.toString(),children:e.name},e.id)):(0,r.jsx)(a.eb,{value:"no-pillars",disabled:!0,children:"No pillars available for this department"})})]})]}),!w&&(0,r.jsx)("p",{className:"text-center text-gray-500",children:"Please select a department to continue."}),w&&(0,r.jsxs)("div",{children:[(0,r.jsxs)("h2",{className:"mb-4 text-xl font-semibold",children:["Assign KPIs for Department:"," ",(0,r.jsx)("span",{className:"text-primary",children:k})]}),(0,r.jsxs)("div",{className:"mb-4 flex items-center justify-between",children:[(0,r.jsx)("span",{})," ",(0,r.jsx)(m.$,{variant:"outline",onClick:()=>{y&&(K.length===y.length?S([]):S(y.map(e=>e.id)))},disabled:!y||0===y.length,children:K.length===(null==y?void 0:y.length)?"Deselect All":"Select All"})]}),(0,r.jsx)("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:null==y?void 0:y.map(e=>(0,r.jsxs)("div",{className:"bg-card flex items-start gap-4 rounded-lg border p-4 shadow-sm",children:[(0,r.jsx)(p.S,{checked:K.includes(e.id),onCheckedChange:()=>T(e.id),className:"mt-1"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-lg font-medium",children:e.title}),(0,r.jsxs)("p",{className:"text-sm",children:[e.elements.length," Fields"]}),(0,r.jsxs)("p",{className:"text-sm",children:["Created on ",new Date(e.createdAt).toLocaleDateString()]})]})]},e.id))})]}),w&&(0,r.jsx)("div",{className:"mt-6 flex justify-end",children:(0,r.jsx)(m.$,{className:"btn btn-primary",onClick:()=>{if(!w){o.toast.error("Please select a department.");return}if(!_){o.toast.error("Please select a pillar.");return}if(0===K.length){o.toast.error("Please select at least one KPI to assign.");return}let e={pillarId:_,departmentId:w,kpiIds:K.map(e=>e.replace("form-",""))};console.log("Assigning KPIs with payload:",e),j.mutate(e)},disabled:j.isPending,children:j.isPending?"Saving...":"Save Assignments"})})]}),"assigned"===C&&(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"mb-8 flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-3xl font-bold",children:"Assigned KPIs"}),(0,r.jsx)("p",{className:"mt-2 text-gray-600",children:"View KPIs that have already been assigned to departments and pillars."})]}),(0,r.jsxs)(a.l6,{onValueChange:e=>{E(e),q(null)},children:[(0,r.jsx)(a.bq,{children:(0,r.jsx)(a.yv,{placeholder:"Select a department"})}),(0,r.jsx)(a.gC,{children:null==f?void 0:f.map(e=>(0,r.jsx)(a.eb,{value:e.id.toString(),children:e.name},e.id))})]}),(0,r.jsxs)(a.l6,{onValueChange:e=>{q(e)},disabled:!z,children:[(0,r.jsx)(a.bq,{children:(0,r.jsx)(a.yv,{placeholder:"Select a pillar"})}),(0,r.jsx)(a.gC,{children:R.length>0?R.map(e=>(0,r.jsx)(a.eb,{value:e.id.toString(),children:e.name},e.id)):(0,r.jsx)(a.eb,{value:"no-pillars",disabled:!0,children:"No pillars available for this department"})})]})]}),!z&&(0,r.jsx)("p",{className:"text-center text-gray-500",children:"Please select a department and pillar to view assigned KPIs."}),z&&!F&&(0,r.jsx)("p",{className:"text-center text-gray-500",children:"Please select a pillar to view assigned KPIs."}),Q&&(0,r.jsx)("div",{className:"py-10 text-center",children:(0,r.jsx)("p",{className:"mt-2 text-gray-600",children:"Loading assigned KPIs..."})}),D&&(0,r.jsxs)("div",{className:"py-10 text-center text-red-500",children:[(0,r.jsx)("p",{children:"Error loading assigned KPIs."}),(0,r.jsx)("p",{className:"text-sm",children:(null==V?void 0:V.message)||"Please try again"})]}),z&&F&&L&&(0,r.jsx)("div",{children:(null===(s=L.assignedKpis)||void 0===s?void 0:s.length)===0?(0,r.jsx)("div",{className:"rounded-lg bg-gray-50 p-8 text-center",children:(0,r.jsx)("p",{className:"text-gray-500",children:"No KPIs have been assigned to this pillar yet."})}):(0,r.jsx)("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:null===(h=L.assignedKpis)||void 0===h?void 0:h.map(e=>{var t;return(0,r.jsxs)(i.Zp,{children:[(0,r.jsxs)(i.aR,{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(i.ZB,{children:e.kpi_name}),(0,r.jsxs)(i.BT,{children:["Created on ",new Date(e.added_date).toLocaleDateString()]})]}),(0,r.jsx)(v.E,{children:e.kpi_value})]}),(0,r.jsxs)(i.Wu,{children:[(0,r.jsxs)("p",{className:"text-sm",children:[(null===(t=e.elements)||void 0===t?void 0:t.length)||0," Fields"]}),(0,r.jsx)("p",{className:"truncate text-sm text-gray-500",title:e.kpi_description,children:e.kpi_description})]}),(0,r.jsx)(i.wL,{})]},e.id)})})})]})]})}},3350:(e,t,s)=>{"use strict";s.d(t,{cn:()=>i});var r=s(7303),a=s(8372);function i(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,a.QP)((0,r.$)(t))}},4764:(e,t,s)=>{"use strict";s.d(t,{bq:()=>u,eb:()=>p,gC:()=>g,l6:()=>o,yv:()=>c});var r=s(7589);s(273);var a=s(242),i=s(6467),n=s(9783),l=s(850),d=s(3350);function o(e){let{...t}=e;return(0,r.jsx)(a.bL,{"data-slot":"select",...t})}function c(e){let{...t}=e;return(0,r.jsx)(a.WT,{"data-slot":"select-value",...t})}function u(e){let{className:t,size:s="default",children:n,...l}=e;return(0,r.jsxs)(a.l9,{"data-slot":"select-trigger","data-size":s,className:(0,d.cn)("border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 shadow-xs flex w-fit items-center justify-between gap-2 whitespace-nowrap rounded-md border bg-transparent px-3 py-2 text-sm outline-none transition-[color,box-shadow] focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg:not([class*='size-'])]:size-4 [&_svg]:pointer-events-none [&_svg]:shrink-0",t),...l,children:[n,(0,r.jsx)(a.In,{asChild:!0,children:(0,r.jsx)(i.A,{className:"size-4 opacity-50"})})]})}function g(e){let{className:t,children:s,position:i="popper",...n}=e;return(0,r.jsx)(a.ZL,{children:(0,r.jsxs)(a.UC,{"data-slot":"select-content",className:(0,d.cn)("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 max-h-(--radix-select-content-available-height) origin-(--radix-select-content-transform-origin) relative z-50 min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border shadow-md","popper"===i&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:i,...n,children:[(0,r.jsx)(x,{}),(0,r.jsx)(a.LM,{className:(0,d.cn)("p-1","popper"===i&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"),children:s}),(0,r.jsx)(m,{})]})})}function p(e){let{className:t,children:s,...i}=e;return(0,r.jsxs)(a.q7,{"data-slot":"select-item",className:(0,d.cn)("focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground outline-hidden *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2 relative flex w-full cursor-default select-none items-center gap-2 rounded-sm py-1.5 pl-2 pr-8 text-sm data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg:not([class*='size-'])]:size-4 [&_svg]:pointer-events-none [&_svg]:shrink-0",t),...i,children:[(0,r.jsx)("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:(0,r.jsx)(a.VF,{children:(0,r.jsx)(n.A,{className:"size-4"})})}),(0,r.jsx)(a.p4,{children:s})]})}function x(e){let{className:t,...s}=e;return(0,r.jsx)(a.PP,{"data-slot":"select-scroll-up-button",className:(0,d.cn)("flex cursor-default items-center justify-center py-1",t),...s,children:(0,r.jsx)(l.A,{className:"size-4"})})}function m(e){let{className:t,...s}=e;return(0,r.jsx)(a.wn,{"data-slot":"select-scroll-down-button",className:(0,d.cn)("flex cursor-default items-center justify-center py-1",t),...s,children:(0,r.jsx)(i.A,{className:"size-4"})})}},6348:(e,t,s)=>{"use strict";s.d(t,{$:()=>d});var r=s(7589);s(273);var a=s(2544),i=s(7135),n=s(3350);let l=(0,i.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function d(e){let{className:t,variant:s,size:i,asChild:d=!1,...o}=e,c=d?a.DX:"button";return(0,r.jsx)(c,{"data-slot":"button",className:(0,n.cn)(l({variant:s,size:i,className:t})),...o})}},7018:(e,t,s)=>{"use strict";s.d(t,{Pm:()=>c,Sr:()=>m,pH:()=>p,xx:()=>g});var r=s(7587),a=s(3269),i=s(2110),n=s(6896),l=s(295),d=s(3497);let o=async()=>(await l.A.get("/api/forms")).data.kpis;function c(){return(0,a.useQuery)({queryKey:["forms"],queryFn:o,staleTime:3e5,refetchOnWindowFocus:!1})}let u=async e=>{try{return(await l.A.post("/api/forms",e)).data}catch(e){var t,s;throw new r.y({name:"PROCESSING_ERROR",message:(null===(s=e.response)||void 0===s?void 0:null===(t=s.data)||void 0===t?void 0:t.error)||"Failed to save form",cause:e})}};function g(){let e=(0,i.useQueryClient)();return(0,n.useMutation)({mutationFn:u,onSuccess:()=>{d.toast.success("Form saved successfully",{description:"Your form has been saved successfully"}),e.invalidateQueries({queryKey:["forms"]})},onError:e=>{d.toast.error("Error saving form",{description:e.message}),console.error("Save form error:",e.name,e.cause)}})}function p(){let e=(0,i.useQueryClient)();return(0,n.useMutation)({mutationFn:async e=>(await l.A.delete("/api/kpi/".concat(e))).data,onSuccess:()=>{d.toast.success("KPI deleted successfully",{description:"The KPI has been deleted from the backend"}),e.invalidateQueries({queryKey:["kpi"]}),e.invalidateQueries({queryKey:["forms"]})},onError:e=>{d.toast.error("Error deleting KPI",{description:e.message}),console.error("Error deleting KPI:",e)}})}let x=async e=>{let{data:t}=await l.A.get("/api/kpi/".concat(e));return console.log("Fetched form data:",t),t},m=e=>(0,a.useQuery)({queryKey:["form",e],queryFn:()=>x(e),enabled:!!e})},7141:(e,t,s)=>{Promise.resolve().then(s.bind(s,2792))},7587:(e,t,s)=>{"use strict";s.d(t,{y:()=>r});class r extends Error{constructor({name:e,message:t,cause:s}){super(t),this.name=e,this.message=t,this.cause=s}}},8980:(e,t,s)=>{"use strict";s.d(t,{S:()=>l});var r=s(7589);s(273);var a=s(1355),i=s(9783),n=s(3350);function l(e){let{className:t,...s}=e;return(0,r.jsx)(a.bL,{"data-slot":"checkbox",className:(0,n.cn)("border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive shadow-xs peer size-4 shrink-0 rounded-[4px] border outline-none transition-shadow focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",t),...s,children:(0,r.jsx)(a.C1,{"data-slot":"checkbox-indicator",className:"flex items-center justify-center text-current transition-none",children:(0,r.jsx)(i.A,{className:"size-3.5"})})})}},9390:(e,t,s)=>{"use strict";s.d(t,{BT:()=>d,Wu:()=>o,ZB:()=>l,Zp:()=>i,aR:()=>n,wL:()=>c});var r=s(7589);s(273);var a=s(3350);function i(e){let{className:t,...s}=e;return(0,r.jsx)("div",{"data-slot":"card",className:(0,a.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",t),...s})}function n(e){let{className:t,...s}=e;return(0,r.jsx)("div",{"data-slot":"card-header",className:(0,a.cn)("@container/card-header has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6 grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6",t),...s})}function l(e){let{className:t,...s}=e;return(0,r.jsx)("div",{"data-slot":"card-title",className:(0,a.cn)("font-semibold leading-none",t),...s})}function d(e){let{className:t,...s}=e;return(0,r.jsx)("div",{"data-slot":"card-description",className:(0,a.cn)("text-muted-foreground text-sm",t),...s})}function o(e){let{className:t,...s}=e;return(0,r.jsx)("div",{"data-slot":"card-content",className:(0,a.cn)("px-6",t),...s})}function c(e){let{className:t,...s}=e;return(0,r.jsx)("div",{"data-slot":"card-footer",className:(0,a.cn)("[.border-t]:pt-6 flex items-center px-6",t),...s})}}},e=>{var t=t=>e(e.s=t);e.O(0,[7823,3497,6948,4431,165,520,2205,5501,8587,4266,7358],()=>t(7141)),_N_E=e.O()}]);